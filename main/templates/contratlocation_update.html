{% extends "layout.html" %}
{% block breadcrumb %}

  <li class="active">Location</li>
{% endblock %}
{% block content %}
<div class="panel panel-default">
  <div class="panel-body">
    <form id="location_form" method="post" action="{% url 'update-location-all' %}">
      {% csrf_token %}
      <input type="hidden" id="previous" name="previous" value="{{request.META.HTTP_REFERER }}"/>
      <input type="hidden" value="{{ location.id }}" name="id"/>
      <input type="hidden" id="prev" name="prev" value="{{prev}}"/>
      <div class="form-group">
        <label for="batiment">Batiment</label>
        <input class="form-control" id="batiment" value="{{location.batiment}}" name="batiment" readonly>
      </div>
      <div class="row">
        <div class="col-md-3">
        <label for="date_debut_location">Date début</label>
        <input class="form-control"
               id="date_debut_location"
               value="{%if location.date_debut%}{{location.date_debut|date:"j/m/Y"}}{%endif%}" name="date_debut"
               readonly>
       {% if form.date_debut.errors%}<font class="erreur_formulaire">{{form.date_debut.errors}}</font>{%endif%}
      </div>

      <div class="col-md-3">
        <label>Date fin</label>
        <input class="form-control" id="date_fin_location"
               value="{%if location.date_fin%}{{location.date_fin|date:"j/m/Y"}}{%endif%}" name="date_fin"
               readonly>
      </div>
      <div class="col-md-3">
        <label>Prolongation</label>
        <select id="slt_type_prolongation"
                name="type_prolongation"
                title="Prolonge la location d'un certain nombre d'années"
                class="form-control">
            <option>-</option>
            <option value="1">1 an</option>
            <option value="7">7 an</option>
        </select>

        </div>
        <div class="col-md-3">
          <label>&nbsp;</label>
         <button type="submit"
                class="btn btn-default"
                id="bt_prolongation"
                name="bt_prolongation">Prolongation</button>
          <span class="erreur_formulaire" id="txt_msg_error_slt_type_prolongation" style="visibility:hidden:display:none;"></span>
        </div>
      </div>
<br>
      <div class="row">
<div class="col-md-3">
        <label>Date renonciation</label>
        <input class="form-control"
               id="renonciation"
               value="{%if location.renonciation%}{{location.renonciation|date:"j/m/Y"}}{%endif%}"
               name="renonciation"
               readonly>
  </div>
        </div>
<br>
        <label for="remarque">Remarque</label>
        <input class="form-control" id="remarque" value="{{location.remarque}}" name="remarque">
<br>

      <div class="row">
        <div class="col-md-3">
        <label for="loyer_base">Loyer de base</label>
        <input class="form-control" id="loyer_base" value="{{location.loyer_base}}" name="loyer_base" readonly>
          {% if form.loyer_base.errors%}<font class="erreur_formulaire">{{form.loyer_base.errors}}</font>{%endif%}
      </div>

      <div class="col-md-3">
        <label for="charges_base">Charges de base</label>
        <input class="form-control" id="charges_base" value="{{location.charges_base}}" name="charges_base" readonly>
        {% if form.charges_base.errors %}<font class="erreur_formulaire">{{form.charges_base.errors}}</font>{%endif%}
      </div>
      <div class="col-md-6">
        <label>Assurance</label>
        <select class="form-control" name="assurance"  class="form-control">
          <option value="-">-</option>
          {%for a in assurances%}
            {%if a.id == location.assurance.id%}
              <option value="{{a.id}}" selected >{{ a }}</option>
            {%else%}
              <option value="{{a.id}}" >{{ a }}</option>
            {%endif%}
          {%endfor%}
      </select>
      </div>
    </div>
    <br>
    <div class="row">
      <div class="col-md-11">
        {%if form.errors%}
          <font class="erreur_formulaire">{{form.errors}}</font>
        {%endif%}
      </div>
      <div class="col-md-1">

    <button type="submit" class="btn btn-primary"
        title="Enregistrer les données relatives à la location"><span class="glyphicon glyphicon-floppy-disk" aria-hidden="true"></span>
    Ok</button>
      </div>
    </div>
    </form>

      <ul class="nav nav-tabs">
        <li class="active"><a data-toggle="tab" href="#financement">Historique loyer</a></li>
        <li><a data-toggle="tab" href="#locataires">Locataires</a></li>
      </ul>

    <div class="tab-content">

        <div id="financement" class="tab-pane fade in active">
          <br>
          <label class="control-label">Historique financements de la location</label>
          <table class="table table-striped table-hover">
            <thead>
                <th>Date début</th>
                <th>Date fin</th>
                <th>Loyer</th>
                <th>Charges</th>
                <th>Index</th>
            </thead>
              <tbody>
            {% for financement in location.financements %}
            <tr>
              <td>{{ financement.date_debut|date:"j/m/Y" }}</td>
              <td>{{ financement.date_fin|date:"j/m/Y" }}</td>
              <td>{{ financement.loyer }}</td>
              <td>{{ financement.charges }}</td>
              <td>{{ financement.index }}</td>
            </tr>
            {% endfor%}
            <tr style="text-align:right">
              <td colspan="5"><a href="{% url 'financement-new' location.pk %}?prev=fl" title="Pour ajouter un nouveau financement"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span></a></td>
            </tr>
              </tbody>
            </table>
        </div>
        <div id="locataires" class="tab-pane fade">
          <br>
          <label class="control-label">Locataires</label>
          <table class="table table-striped table-hover">
            <thead>
                <th>Nom</th>
                <th>Prénom</th>
                <th>Informations complémentaires</th>
                <th>Principal</th>
                <th></th>
            </thead>
              <tbody>
            {% for locataire in location.locataires %}
            <tr>
              <td><a href="{% url 'locataire' locataire.id %}" title="Pour modifier un locataire">{{ locataire.personne.nom}}</a></td>
              <td><a href="{% url 'locataire' locataire.id %}" title="Pour modifier un locataire">{{ locataire.personne.prenom }}</a></td>
              <td>{% if locataire.infos_complement %}{{ locataire.infos_complement }}{%endif%}</td>
              <td><input type="checkbox" {% if locataire.principal%}checked{%endif%} readonly></td>
              <td><a href="{% url 'locataire-delete' locataire.id %}" title="Pour supprimer un locataire"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></a></td>
            </tr>
            {% endfor%}
            <tr style="text-align:right">
              <td colspan="5"><a href="{% url 'locataire-new' location.pk %}" title="Pour ajouter un nouveau locataire"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span></a></td>
            </tr>
              </tbody>
            </table>
        </div>
      </div>
  </div>
</div>

{% endblock %}
