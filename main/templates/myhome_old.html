{% extends "layout.html" %}
{% load staticfiles %}
{% load order %}
{% block breadcrumb %}
<li class="active">Mon tableau de bord</li>
{% endblock %}
{% block content %}
<input type="hidden" id="previous" name="previous" value="{{request.META.HTTP_REFERER}}"/>
<br>
<div class="row">
    <div class="col-md-6">
        <div class="panel panel-default">
            <div class="panel-heading">Mes batiments</div>
            <div class="panel-body">
                <table class="table table-striped table-hover">
                    <thead>
                    <th>Rue</th>
                    <th>Numéro</th>
                    <th>Boite</th>
                    <th>Localité</th>
                    <th colspan="2">Location actuelle</th>
                    </thead>
                    {% for batiment in batiments %}
                    <tr>
                        <td>
                            <a href="{% url 'batiment' batiment.pk%}"
                               title="Pour modifier un batiment">{{ batiment.rue }}</a>
                        </td>
                        <td>
                            {{ batiment.numero | default_if_none:''}}
                        </td>
                        <td>
                            {{ batiment.boite | default_if_none:'' }}
                        </td>
                        <td>
                            {{ batiment.localite | default_if_none:'' }}
                        </td>

                        <td>
                            {% if batiment.location_actuelle%}
                            {{ batiment.location_actuelle.date_debut|date:"j/m/Y" }}
                            {%endif%}
                        </td>
                        <td>
                            {% if batiment.location_actuelle%}
                            {{ batiment.location_actuelle.date_fin|date:"j/m/Y" }}
                            {%endif%}
                        </td>
                    </tr>
                    {% endfor%}
                </table>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="panel panel-default">
            <div class="panel-heading">Alertes</div>
            <div class="panel-body">
                <table class="table table-striped table-hover">
                    <thead>
                    <th>Description</th>
                    <th>Date alerte</th>
                    <th>Contrat</th>
                    <th>Etat</th>
                    <th></th>
                    </thead>
                    {% for alerte in alertes %}
                    <tr>
                        <td>{{ alerte.description| default_if_none:'' }}</td>
                        <td>{{ alerte.date_alerte|date:"j/m/Y" | default_if_none:'' }}</td>
                        {%if alerte.contrat_gestion%}
                        <td>{{ alerte.contrat_gestion }}</td>
                        {%endif%}
                        {% if alerte.contrat_location%}
                        <td>{{alerte.contratLocation.batiment}},
                            {{alerte.contrat_location.date_debut|date:"j/m/Y" }}
                            -{{alerte.contrat_location.date_fin|date:"j/m/Y" }}
                        </td>
                        {%endif%}
                        <td>{{ alerte.etat| default_if_none:'' }}</td>
                        <td>
                            <a href="{% url 'alerte-update' alerte.pk %}" title="Passe à l'état vérifier"><img
                                    src="{% static 'images/glyphicons-153-check.png' %}"/></a>
                        </td>
                    </tr>
                    {% endfor%}
                </table>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-md-6">
        <div class="panel panel-default">
            <div class="panel-heading">Mes contrats de gestion</div>
            <div class="panel-body">
                <table class="table table-striped table-hover">
                    <thead>
                    <th>Batiment</th>
                    <th>Date début</th>
                    <th>Date fin</th>
                    <th>Montant</th>
                    </thead>
                    {% for contrat in contrats %}
                    <tr>
                        <td><a href="{% url 'gestion-prepare-update-all' contrat.pk%}"
                               title="Pour modifier un contrat de gestion">{{ contrat.batiment }}</a></td>
                        <td>{% if contrat.date_debut %}{{ contrat.date_debut|date:"j/m/Y" }}{% endif%}</td>
                        <td>{% if contrat.date_fin %}{{ contrat.date_fin|date:"j/m/Y" }}{% endif%}</td>
                        <td>{{ contrat.montant_mensuel }}</td>
                    </tr>
                    {% endfor%}
                </table>
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="panel panel-default">
            <div class="panel-heading">Suivis loyer</div>
            <div class="panel-body">
                <table class="table table-condensed">
                    <thead>
                    <th>Batiment</th>
                    <th>Date paiement</th>
                    <th>Etat</th>
                    <th>Loyer</th>
                    <th>Charges</th>
                    <th></th>
                    </thead>
                    <tbody>
                    {% for s in suivis %}
                    <tr class="{{s.etat_suivi}}">
                        <td>{{s.financement_location.contrat_location.batiment}}</td>
                        <td>{{s.date_paiement|date:"j/m/Y"}}</td>
                        <td>{{s.etat_suivi}}</td>
                        <td style="background-color:{%if s.loyer_percu == s.financement_location.loyer%}transparent{% else %}red{% endif %};">
                            {{s.loyer_percu}} ({{s.financement_location.loyer}})
                        </td>
                        {% if s.financement_location.charges > 0 %}
                        <td style="background-color:{%if s.charges_percu == s.financement_location.charges%}transparent{% else %}red{% endif %};">
                            {{s.charges_percu}} ({{s.financement_location.charges}})
                        </td>
                        {% else %}
                        <td>-</td>
                        {% endif %}
                        <td><a href="{% url 'suivis-updatel' s.id %}?dated={{date_debut|date:" j/m/Y"}}&datef={{date_fin|date:"j/m/Y"}}&etat={{etat}}"
                            title="Pour modifier un suivi" onclick="submit()"><span class="glyphicon glyphicon-pencil"
                                                                                    aria-hidden="true"></span></a></td>
                    </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-md-6">
        <div class="panel panel-default">
            <div class="panel-heading">Honoraires</div>
            <div class="panel-body">
                {% include "sub_honoraire_list.html" %}
            </div>
        </div>
    </div>
    <div class="col-md-6">
        {% include "sub_finances_list.html" %}
    </div>
</div>

{% endblock %}
